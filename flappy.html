<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flappy Bird Clone</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #70c5ce;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: sans-serif;
    }
    canvas {
      background: #70c5ce;
      display: block;
    }
    #ui {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
    }
    button {
      pointer-events: auto;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="ui"></div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const ui = document.getElementById('ui');

    // Fixed game size (keeps aspect like original) but centered and responsive scaling via CSS transform
    const GAME_WIDTH = 400;
    const GAME_HEIGHT = 600;

    // Set internal canvas size
    canvas.width = GAME_WIDTH;
    canvas.height = GAME_HEIGHT;

    // Scale canvas to fit viewport while preserving aspect ratio
    function scaleCanvasToWindow() {
      const scale = Math.min(window.innerWidth * 0.95 / GAME_WIDTH, window.innerHeight * 0.95 / GAME_HEIGHT);
      canvas.style.width = (GAME_WIDTH * scale) + 'px';
      canvas.style.height = (GAME_HEIGHT * scale) + 'px';
    }
    window.addEventListener('resize', scaleCanvasToWindow);
    scaleCanvasToWindow();

    // --- Assets (placeholders) ---
    const birdImg = new Image();
    birdImg.src = 'bird.png';

    const pipeTopImg = new Image();
    pipeTopImg.src = 'pipe_top.png';

    const pipeBottomImg = new Image();
    pipeBottomImg.src = 'pipe_top.png';

    // Audio placeholders (won't throw if not loaded)
    const loseSound = new Audio('Game.m4a');
    const winSound = new Audio('Game.m4a');

    // Game objects & constants
    let bird = {
      x: 60,
      y: GAME_HEIGHT / 2,
      width: 34,
      height: 24,
      gravity: 0.8,
      lift: -12,
      velocity: 0,
    };

    const PIPE_WIDTH = 60;
    const GAP = 240;
    let pipes = [];
    let frame = 0;
    let gameOver = false;
    let gameStarted = false;
    let score = 0;

    // Start button (centered)
    const startButton = document.createElement('button');
    startButton.innerText = 'Start Game (or press SPACE)';
    Object.assign(startButton.style, {
      position: 'absolute',
      top: '50%',
      left: '50%',
      transform: 'translate(-50%, -50%)',
      padding: '12px 18px',
      fontSize: '16px',
      borderRadius: '8px',
      cursor: 'pointer',
    });
    ui.appendChild(startButton);

    const scoreEl = document.createElement('div');
    Object.assign(scoreEl.style, {
      position: 'absolute',
      top: '12px',
      left: '50%',
      transform: 'translateX(-50%)',
      fontSize: '28px',
      fontWeight: '700',
      color: '#fff',
      textShadow: '0 2px 0 rgba(0,0,0,0.2)'
    });
    scoreEl.textContent = '0';
    ui.appendChild(scoreEl);

    function resetGame() {
      bird.y = GAME_HEIGHT / 2;
      bird.velocity = 0;
      pipes = [];
      frame = 0;
      gameOver = false;
      score = 0;
      scoreEl.textContent = score;
    }

    function startGame() {
      gameStarted = true;
      startButton.style.display = 'none';
      resetGame();
    }

    startButton.addEventListener('click', startGame);

    // Controls: SPACE to start / jump. On mobile screen tap to start / jump.
    window.addEventListener('keydown', (e) => {
      if (e.code === 'Space') {
        if (!gameStarted) startGame();
        else jump();
        e.preventDefault();
      }
    });

    window.addEventListener('touchstart', (e) => {
      // simple behavior: first touch starts, subsequent touches jump
      if (!gameStarted) startGame();
      else jump();
      e.preventDefault();
    }, {passive: false});

    function jump() {
      if (gameOver) return;
      bird.velocity = bird.lift;
    }

    function createPipe() {
      const topHeight = Math.floor(Math.random() * (GAME_HEIGHT - GAP - 80)) + 40; // leave margins
      pipes.push({ x: GAME_WIDTH, top: topHeight, bottom: topHeight + GAP, passed: false });
    }

    function update() {
      // Only update physics when game started and not over
      if (!gameStarted || gameOver) return;

      // Apply physics
      bird.velocity += bird.gravity;
      bird.velocity *= 0.98; // simple air resistance
      bird.y += bird.velocity;

      // Create pipes periodically
      if (frame % 90 === 0) createPipe();

      // Move pipes
      for (let i = pipes.length - 1; i >= 0; i--) {
        const pipe = pipes[i];
        pipe.x -= 2.8; // speed

        // Score when passing pipe
        if (!pipe.passed && pipe.x + PIPE_WIDTH < bird.x) {
          pipe.passed = true;
          score += 1;
          scoreEl.textContent = score;
          
          // Check if player reached 10 points (WIN CONDITION)
          if (score >= 10) {
            endGame(true); // true = win
          }
        }

        // Collision detection (AABB)
        if (
          bird.x < pipe.x + PIPE_WIDTH &&
          bird.x + bird.width > pipe.x &&
          (bird.y < pipe.top || bird.y + bird.height > pipe.bottom)
        ) {
          endGame(false);
        }

        // Remove off-screen pipes
        if (pipe.x + PIPE_WIDTH < -50) {
          pipes.splice(i, 1);
        }
      }

      // Ground / ceiling collision
      if (bird.y + bird.height > GAME_HEIGHT || bird.y < 0) {
        endGame(false);
      }

      frame++;
    }

    function endGame(win) {
      if (gameOver) return;
      gameOver = true;
      gameStarted = false;
      // play sounds safely
      try { if (win) winSound.play(); else console.log('lose'); } catch (e) { /* ignore */ }

      // Show restart button
      startButton.innerText = 'Restart Game';
      startButton.style.display = 'block';
    }

    function draw() {
      // clear
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // background simple
      ctx.fillStyle = '#70c5ce';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // draw pipes
      pipes.forEach(pipe => {
        // Draw top pipe
        if (pipeTopImg.complete && pipeTopImg.naturalWidth !== 0) {
          // Draw image to fill from 0 to pipe.top
          ctx.drawImage(pipeTopImg, pipe.x, 0, PIPE_WIDTH, pipe.top);
        } else {
          // Fallback to green rectangle
          ctx.fillStyle = '#5cb85c';
          ctx.fillRect(pipe.x, 0, PIPE_WIDTH, pipe.top);
          ctx.strokeStyle = '#e0e0e0';
          ctx.lineWidth = 2;
          ctx.strokeRect(pipe.x, 0, PIPE_WIDTH, pipe.top);
        }
        
        // Draw bottom pipe
        if (pipeBottomImg.complete && pipeBottomImg.naturalWidth !== 0) {
          // Draw image from pipe.bottom to canvas height
          ctx.drawImage(pipeBottomImg, pipe.x, pipe.bottom, PIPE_WIDTH, canvas.height - pipe.bottom);
        } else {
          // Fallback to green rectangle
          ctx.fillStyle = '#5cb85c';
          ctx.fillRect(pipe.x, pipe.bottom, PIPE_WIDTH, canvas.height - pipe.bottom);
          ctx.strokeStyle = '#e0e0e0';
          ctx.lineWidth = 2;
          ctx.strokeRect(pipe.x, pipe.bottom, PIPE_WIDTH, canvas.height - pipe.bottom);
        }
      });

      // draw bird (use image if loaded else fallback)
      if (birdImg.complete && birdImg.naturalWidth !== 0) {
        ctx.drawImage(birdImg, bird.x, bird.y, bird.width, bird.height);
      } else {
        ctx.fillStyle = '#ffdd57';
        ctx.fillRect(bird.x, bird.y, bird.width, bird.height);
      }

      // If game not started, show hint
      if (!gameStarted && !gameOver) {
        ctx.fillStyle = 'rgba(0,0,0,0.5)';
        ctx.font = '18px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('Press SPACE or TAP to start â€” then SPACE/TAP to flap', canvas.width/2, canvas.height/2 - 60);
      }

      // If game over, show overlay
      if (gameOver) {
        ctx.fillStyle = 'rgba(0,0,0,0.5)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#fff';
        ctx.font = '36px sans-serif';
        ctx.textAlign = 'center';
        
        // Show win or lose message
        if (score >= 10) {
          ctx.fillText('You Win! ðŸŽ‰', canvas.width/2, canvas.height/2 - 20);
        } else {
          ctx.fillText('Game Over', canvas.width/2, canvas.height/2 - 20);
        }
        
        ctx.font = '20px sans-serif';
        ctx.fillText('Score: ' + score, canvas.width/2, canvas.height/2 + 20);
      }
    }

    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    // Start the render loop
    loop();
  </script>
</body>
</html>